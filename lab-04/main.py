import sys
import os

# -------------------------------------------------------------------------
# НАСТРОЙКА ОКРУЖЕНИЯ (BOOTSTRAP)
# -------------------------------------------------------------------------
# Python по умолчанию ищет модули только в текущей директории и системных путях.
# Чтобы иметь возможность импортировать наши пакеты ('base', 'specialists' и т.д.)
# из любой точки запуска, мы принудительно добавляем корневую папку проекта в sys.path.
project_root = os.path.dirname(os.path.abspath(__file__))
sys.path.append(project_root)

# -------------------------------------------------------------------------
# БЕЗОПАСНЫЙ ИМПОРТ МОДУЛЕЙ
# -------------------------------------------------------------------------
# Мы оборачиваем импорт тестов в блок try-except, чтобы предоставить пользователю
# понятное сообщение об ошибке, если структура проекта нарушена (например, удален __init__.py).
try:
    from tests.test_part1 import TestPart1
    from tests.test_part2 import TestPart2
    from tests.test_part3 import TestPart3
    from tests.test_part4 import TestPart4
except ImportError as e:
    print("\n!!! КРИТИЧЕСКАЯ ОШИБКА ИНИЦИАЛИЗАЦИИ !!!")
    print("Не удалось загрузить модули тестирования. Возможные причины:")
    print("1. Отсутствуют файлы '__init__.py' в папках пакетов (tests, base, etc).")
    print("2. Нарушена структура каталогов проекта.")
    print("-" * 50)
    print(f"Техническая детализация ошибки: {e}")
    print("-" * 50)
    sys.exit(1)

if __name__ == "__main__":
    """
    ГЛАВНАЯ ТОЧКА ВХОДА (ENTRY POINT)
    
    Этот скрипт выполняет роль Test Runner'а. Он последовательно запускает 
    наборы тестов (Test Suites), соответствующие каждому этапу разработки 
    лабораторной работы.
    """
    
    print("=======================================================")
    print("   ЗАПУСК СИСТЕМЫ УЧЕТА СОТРУДНИКОВ: INTEGRATION TESTS")
    print("=======================================================\n")

    # ---------------------------------------------------------------------
    # ЭТАП 1: Базовая архитектура и Инкапсуляция
    # ---------------------------------------------------------------------
    # Цель: Проверить корректность работы класса Employee.
    # Проверяется: 
    # - Приватность атрибутов (__id, __name).
    # - Работа геттеров и сеттеров (@property).
    # - Валидация входных данных (выброс исключений ValueError).
    TestPart1.run()

    # ---------------------------------------------------------------------
    # ЭТАП 2: Иерархия классов и Фабричный метод
    # ---------------------------------------------------------------------
    # Цель: Проверить механизмы наследования и создания объектов.
    # Проверяется:
    # - Работа специализированных классов (Manager, Developer, Salesperson).
    # - Корректность переопределения методов calculate_salary и get_info.
    # - Работа EmployeeFactory для генерации объектов по строковому типу.
    TestPart2.run()

    # ---------------------------------------------------------------------
    # ЭТАП 3: Полиморфизм коллекций и Магические методы
    # ---------------------------------------------------------------------
    # Цель: Проверить удобство работы с объектами как с типами данных.
    # Проверяется:
    # - Магические методы сравнения и арифметики (__eq__, __lt__, __add__).
    # - Работа класса Department как коллекции (iter, len, contains).
    # - Базовая сериализация сотрудников в словарь.
    TestPart3.run()

    # ---------------------------------------------------------------------
    # ЭТАП 4: Композиция, Агрегация и Системная интеграция
    # ---------------------------------------------------------------------
    # Цель: Проверить работу системы как единого целого.
    # Проверяется:
    # - Класс Company (Агрегатор) и Project (Композиция команды).
    # - Сложная сериализация (сохранение связей по ID, а не дублирование объектов).
    # - Защита целостности данных (DependencyError при удалении).
    # - Экспорт отчетов в CSV (с учетом кодировки UTF-8-SIG).
    TestPart4.run()

    print("\n=======================================================")
    print(" [OK] ВСЕ ТЕСТОВЫЕ СЦЕНАРИИ УСПЕШНО ВЫПОЛНЕНЫ")
    print("=======================================================")
    print(" Результаты (JSON дампы, CSV отчеты) сохранены в папке 'docs/'.")
