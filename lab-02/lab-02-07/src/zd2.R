# Подключение библиотеки параллельных вычислений
library(parallel)

# 1. Исходная функция, которую нужно вызывать
mean_of_rnorm <- function(n) {
  random_numbers <- rnorm(n)
  mean(random_numbers)
}

# 2. Настройка кластера
# Определяем количество ядер (обычно берут все доступные минус 1, чтобы не зависла ОС)
n_cores <- detectCores() - 1 
cl <- makeCluster(n_cores)

# Важный шаг: экспорт функции на рабочие узлы (workers), 
# иначе они "не увидят" функцию mean_of_rnorm
clusterExport(cl, "mean_of_rnorm")

# 3. Параллельное выполнение
# Исходная задача: выполнить функцию 50 раз для аргумента 10000.
# Используем parSapply (аналог sapply, но параллельный)
# Мы итерируемся 50 раз (seq_len(50)), и в каждой итерации вызываем функцию.
# Аргумент 'i' в анонимной функции не используется, он просто счетчик.
results <- parSapply(cl, seq_len(50), function(i) {
  mean_of_rnorm(10000)
})

# 4. Остановка кластера (освобождение ресурсов)
stopCluster(cl)

# Вывод результатов
print(results)
